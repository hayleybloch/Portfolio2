(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[50],{2233:e=>{e.exports={folder:"FolderView_folder__lD1mg","selection-box":"FolderView_selection-box__723Zg","icons-container":"FolderView_icons-container__48W0g","hide-overflow":"FolderView_hide-overflow__AD36X","selection-box-container":"FolderView_selection-box-container__pEZi_"}},3050:(e,t,n)=>{"use strict";n.r(t),n.d(t,{FolderView:()=>m,default:()=>w});var r=n(7876),i=n(9582),o=n(4232),l=n(8847),u=n.n(l),c=n(2233),a=n.n(c),d=n(3388),s=n(4199),f=n(1881),v=n(7718),y=n(3932),p=n(5134),h=n(9049);let x=u()(()=>Promise.resolve().then(n.bind(n,3388)),{loadableGenerated:{webpack:()=>[3388]}});function m(e){let{directory:t,apis:n,onFileOpen:l,localIconPosition:u,allowOverflow:c}=e,m=n.fileSystem,w=null!=u&&u,[g,E]=(0,o.useState)([]),b=(0,o.useRef)(new f.sW);function k(e){b.current=e,E(e.toArray())}let L=(0,o.useRef)(null),F=(0,o.useRef)(null),T=n.dragAndDrop,_=(0,o.useRef)(t),R=(0,o.useRef)({x:0,y:0}),H=(0,o.useRef)(!1),I=(0,o.useRef)({file:null,timestamp:0}),X=(0,o.useRef)({x:0,y:0}),C=(0,o.useRef)(),O=(0,o.useRef)([]),Y=(0,o.useRef)(),B=(0,o.useRef)(null),[D,M]=(0,o.useState)({open:!1,x:0,y:0,width:0,height:0});function N(e){let t=L.current.getBoundingClientRect();return{x:e.x-t.left,y:e.y-t.top}}function j(e,t){return t.scrollLeft+e}function A(e,t){return t.scrollTop+e}function W(e,t){return{x:j(e.x,t),y:A(e.y,t)}}function V(e){let t=b.current,n=R.current;if(!F.current)return;let r=F.current,i=N(e),o={x:Math.min(n.x,i.x),y:Math.min(n.y,i.y)},l={x:Math.max(n.x,i.x),y:Math.max(n.y,i.y)},u={x1:j(o.x,r),x2:j(l.x,r),y1:A(o.y,r),y2:A(l.y,r)};for(let e of t.iterFromHead()){let t=e.value,n=(0,d.FolderIconHitBox)(t);t.selected=(0,s.fh)(u,n)}k(t)}function S(e){if(!F.current)return;let t=F.current.scrollLeft,n=F.current.scrollTop,r=Math.abs(X.current.x-e.clientX-t),i=Math.abs(X.current.y-e.clientY-n),o=C.current;if(!o)return;let l={nodes:O.current.map(e=>{let t={x:o.x-e.x,y:o.y-e.y};return{item:e.entry.node,position:{x:0,y:0},offset:t}})};if((r>5||i>5)&&!H.current&&(H.current=!0,B.current=T.start(l,e.clientX-2*t,e.clientY-2*n)),H.current&&B.current){B.current.move(e.clientX-2*t,e.clientY-2*n);let r=document.elementsFromPoint(e.clientX,e.clientY),i=null;for(let e of r){if(e.hasAttribute("data-drop-point")){i=e;break}if(e.hasAttribute("data-window-root"))break}if(!i){Y.current=void 0;return}let o=i.getBoundingClientRect();for(let t of l.nodes)t.position={x:e.clientX-o.left-t.offset.x,y:e.clientY-o.top-t.offset.y};let c=new CustomEvent(v.CH,{detail:l,bubbles:!1});if(null==i||i.dispatchEvent(c),i!==Y.current){var u;let e=new CustomEvent(v.JD,{detail:l,bubbles:!1}),t=new CustomEvent(v.iP,{detail:l,bubbles:!1});null==(u=Y.current)||u.dispatchEvent(t),null==i||i.dispatchEvent(e),Y.current=i}}}function J(e){var t,n,r;window.removeEventListener("pointermove",S),window.removeEventListener("pointerup",J);let i=null==(t=Y.current)?void 0:t.getBoundingClientRect(),o=C.current;if(!o||!i){null==(r=B.current)||r.drop(e.clientX,e.clientY);return}if(Y.current){let t={nodes:O.current.map(t=>{let n={x:o.x-t.x,y:o.y-t.y},r={x:e.clientX-i.left-n.x,y:e.clientY-i.top-n.y};return{item:t.entry.node,position:r,offset:n}})},n=new CustomEvent(v._L,{detail:t,bubbles:!1});Y.current.dispatchEvent(n)}null==(n=B.current)||n.drop(e.clientX,e.clientY),B.current=null,Y.current=void 0,H.current=!1}function q(){for(let e of b.current.iterFromTail())e.value.editing.active&&(m.renameNode(e.value.entry.node,e.value.editing.value),e.value.editing.active=!1)}function G(e){if(e.preventDefault(),e.touches.length>1)return;let t=e.touches[0];Z({x:t.clientX,y:t.clientY},"touch")}function P(e){"touch"!==e.pointerType&&Z({x:e.clientX,y:e.clientY},"pointer")}function Z(e,t){if(!L.current||!F.current)return;let n=function(e){let t=b.current;if(!F.current)return;let n=F.current,r=W(N(e),n);for(let e of t.iterFromTail()){let t=e.value,n=(0,d.FolderIconHitBox)(t),i=(0,s.R2)(r,n);if(i>=0)return{iconEntry:e.value,clickedOnTheIcon:0===i}}}(e);if(n){var r,i,o;let t=F.current.getBoundingClientRect();C.current={x:e.x-t.left-F.current.scrollLeft,y:e.y-t.top-F.current.scrollTop},n.iconEntry.selected||(q(),function(e){let t=b.current;if(!F.current)return;let n=F.current,r=W(N(e),n),i=!1;for(let e of t.iterFromHead()){let n=e.value,o=(0,d.FolderIconHitBox)(n),l=(0,s.JT)(r,o)&&!i;n.selected=l,l&&(t.moveToHead(e),i=!0)}k(t)}(e));let u=b.current;window.addEventListener("pointermove",S),window.addEventListener("pointerup",J);let c=[];for(let e of u.iterFromTail()){let t=e.value;t.selected&&c.push(t)}O.current=c,X.current={x:e.x,y:e.y};let a=(null==(r=I.current.file)?void 0:r.iconEntry)===n.iconEntry,f=(null==(i=I.current.file)?void 0:i.clickedOnTheIcon)===n.clickedOnTheIcon,v=n.clickedOnTheIcon;a&&v?(q(),l(n.iconEntry.entry.node,!1),I.current={file:null,timestamp:0}):a&&f&&!v?((o=n.iconEntry).entry.node.editable&&(o.editing={active:!0,value:o.entry.node.name,onSave:()=>{q()}},k(b.current)),I.current={file:null,timestamp:0}):I.current={file:n,timestamp:Date.now()}}else q(),C.current=void 0,function(e,t){switch(R.current=N(e),t){case"pointer":window.addEventListener("pointermove",z),window.addEventListener("pointerup",Q);break;case"touch":window.addEventListener("touchmove",U),window.addEventListener("touchend",$)}}(e,t)}function z(e){"touch"!==e.pointerType&&K({x:e.clientX,y:e.clientY})}function U(e){let t=e.touches[0];K({x:t.clientX,y:t.clientY})}function K(e){let t=R.current,n=N(e),r={x:Math.min(t.x,n.x),y:Math.min(t.y,n.y)},i={x:Math.max(t.x,n.x),y:Math.max(t.y,n.y)},o=r.x,l=r.y;M({open:!0,x:o,y:l,width:i.x-r.x,height:i.y-r.y}),V(e)}function Q(e){"touch"!==e.pointerType&&ee({x:e.clientX,y:e.clientY},"pointer")}function $(e){if(e.touches.length>0)return;let t=e.changedTouches[0];ee({x:t.clientX,y:t.clientY},"touch")}function ee(e,t){switch(V(e),D.open=!1,M(D),t){case"pointer":window.removeEventListener("pointermove",z),window.removeEventListener("pointerup",Q);break;case"touch":window.removeEventListener("touchmove",U),window.removeEventListener("touchend",$)}}function et(e){let t=b.current;!function(e,t){var n;let r=new Set,i=null!=(n=t.detail.nodes[0])?n:null;if(i){for(let e of t.detail.nodes)r.add(e.item.id);for(let t of e.iterFromTail()){let e=t.value,n=e.entry.node;if(r.has(n.id))continue;if("directory"!==n.kind){e.selected=!1;continue}let o=(0,d.FolderIconHitBox)(e),l={x:i.position.x+i.offset.x,y:i.position.y+i.offset.y};e.selected=(0,s.JT)(l,o)}}}(t,e),k(t)}function en(e){let t=b.current,n=new Map;if(!L.current)return;let r=L.current,o=function(e,t){var n;let r=new Set,i=null!=(n=t.detail.nodes[0])?n:null,o=m.getDirectory(_.current);if(!o.isOk())return(0,p._q)(Error("Unable to lookup currentDirectory"));if(!i)return(0,p.ok)(o.value);for(let e of t.detail.nodes)r.add(e.item.id);for(let t of e.iterFromTail()){let e=t.value.entry.node;if("directory"!==e.kind||r.has(e.id))continue;let n=(0,d.FolderIconHitBox)(t.value),o={x:i.position.x+i.offset.x,y:i.position.y+i.offset.y};if((0,s.JT)(o,n))return(0,p.ok)(e)}return(0,p.ok)(o.value)}(t,e);if(!o.isOk())return;let l=(0,h.tG)(o.value)===_.current,u=!l,c=r.getBoundingClientRect(),a={min:-d.IconWidth/2,max:c.width-d.IconWidth/2},f={min:-d.IconHeight/2,max:c.height-d.IconHeight/2};e:for(let r of e.detail.nodes){let e,c;if(r.item.parent&&r.item.parent.id!==o.value.id){let e=r.item.parent;n.set(e.id,e),u=!0}let d=l?[]:o.value.children.toArray(),s=m.moveNode(r.item,o.value);if(!s.isOk())continue;let v=s.value;if(l)e=(0,y.qE)(r.position.x,a.min,a.max),c=(0,y.qE)(r.position.y,f.min,f.max);else{let t=(0,i.aE)(o.value.settings,o.value.content,d);e=t.x,c=t.y}w||(v.x=e,v.y=c);let p={entry:v,x:e,y:c,selected:!1,dragging:!1,editing:{active:!1,value:r.item.name}};for(let e of t.iterFromTail())if(e.value.entry.node.id===v.node.id){e.value=p;continue e}t.append(p)}u?(n.forEach(e=>m.propagateNodeEvent(e,{kind:"update"})),m.propagateNodeEvent(o.value,{kind:"update"})):(w||m.propagateNodeEvent(o.value,{kind:"refresh"}),k(t))}function er(){if(w||!F.current||!_.current)return;let e=m.getDirectory(_.current);if(!e.isOk())return;let t=F.current,n=t.scrollWidth,r=t.scrollHeight;e.value.content.width=n,e.value.content.height=r}(0,o.useEffect)(()=>{if(!L.current)return;let e=L.current;e.addEventListener("touchstart",G,{passive:!1}),e.addEventListener("pointerdown",P,{passive:!1}),e.addEventListener(v.CH,et),e.addEventListener(v._L,en);let t=new ResizeObserver(er);return t.observe(L.current),er(),()=>{e.removeEventListener("touchstart",G),e.removeEventListener("pointerdown",P),e.removeEventListener(v.CH,et),e.removeEventListener(v._L,en),t.disconnect()}},[]),(0,o.useEffect)(()=>{let e=function(e){let t=t=>(function(e,t){if("rename"===t.kind){let e=m.getDirectory(t.path);return e.isOk()&&l(e.value,!0),null}let n=m.getDirectory(e);if(!n.isOk())return null;if(_.current=(0,h.tG)(n.value),w)!function(e,t){if("refresh"===t.kind||!L.current)return;let n=L.current,r=b.current,o=new Map,l=new f.sW,u=[];for(let e of r.iterFromTail()){let t=e.value,n=t.entry.node.id;o.set(n,t)}for(let t of e.children.iterFromTail()){let e=o.get(t.value.node.id);if(!e){u.push(t.value);continue}l.append({entry:t.value,selected:!1,dragging:!1,x:e.x,y:e.y,editing:{active:!1,value:t.value.node.name}})}let c={view:"icons",width:n.clientWidth,height:n.clientHeight,overflowBehavior:"overlay"};for(let e of u){let t={alwaysOpenAsIconView:!1,sortBy:null,sortDirection:"vertical",sortOrigin:"top-right"},n=(0,i.aE)(t,c,l.toArray());l.append({entry:e,selected:!1,dragging:!1,x:n.x,y:n.y,editing:{active:!1,value:e.node.name}})}k(l)}(n.value,t);else{var r=n.value;let e=new f.sW;for(let t of r.children.iterFromTail())e.append({entry:t.value,selected:!1,dragging:!1,x:t.value.x,y:t.value.y,editing:{active:!1,value:t.value.node.name}});k(e)}return n.value})(e,t),n=t({kind:"update"});if(n)return m.subscribe(n,t)}(t);return er(),()=>{e&&e()}},[t]);let ei=g.map((e,t)=>(0,r.jsx)(x,{folderIconEntry:e,index:t},t)),eo=D.open?(0,r.jsx)("div",{className:a()["selection-box"],style:{width:D.width,height:D.height,top:D.y,left:D.x}}):(0,r.jsx)(r.Fragment,{});return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{ref:L,className:a().folder,"data-drop-point":"true",children:[(0,r.jsx)("div",{className:a()["selection-box-container"],children:eo}),(0,r.jsx)("div",{ref:F,className:[a()["icons-container"],!(null==c||c)?a()["hide-overflow"]:""].join(" "),children:ei})]})})}let w=m}}]);